<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views
        xmlns="http://axelor.com/xml/ns/object-views"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
      http://axelor.com/xml/ns/object-views
      http://axelor.com/xml/ns/object-views/object-views_6.1.xsd">

    <form title="Revenue by Day"  name="report-revenue-list"  model="com.axelor.apps.svh.db.Registration"
           width="large">
        <panel>
            <panel-dashlet action="chart:svh.chart.revenue.by.day"/>
        </panel>
    </form>

    <chart name="svh.chart.revenue.by.day" title="Revenue per day by tariff"
            stacked="true"  onInit="svh.chart.onInit.today">

        <search-fields>
            <field type="datetime" name="fromDateTime" title="From Date" x-required="true"/>
            <field type="datetime" name="toDateTime" title="To Date" x-required="true"/>
        </search-fields>

        <dataset type="jpql">                                                                                           <!-- ===== DATASET: доход по тарифам и общий ===== -->
            <![CDATA[
                SELECT
                    SUM(self.calculated_amount) AS amount,
                    self.createdOn AS day,
                    COALESCE(self.transport_type, 'Total') AS tariff
                FROM com.axelor.apps.svh.db.Registration self
                WHERE self.createdOn BETWEEN :fromDateTime AND :toDateTime
                GROUP BY self.createdOn, self.transport_type
                ORDER BY self.createdOn
            ]]>
        </dataset>
        <category key="day" type="date" title="Day"/>
        <series key="amount" type="bar" title="Revenue by Tariff" groupBy="tariff"/>                                     <!-- Сумма по тарифам -->
        <series key="amount" type="line" title="Total Revenue" groupBy="tariff"/>                                        <!-- Общий доход за день -->
    </chart>


    <action-attrs name="svh.chart.onInit.today">                                                                        <!-- ===== ACTION-ATTRS: по умолчанию за сегодня ===== -->
        <attribute for="toDateTime" name="value" expr="eval:__datetime__"/>
        <attribute for="fromDateTime" name="value" expr="eval:__datetime__.withHour(0).withMinute(0).withSecond(0)"/>
    </action-attrs>
</object-views>
